library(ggplot2)
library(rlang)

terrain.text <- '{[27] = {type = "", center = {x = -699.695923, y = 478.42099}, border = std::vector of length 17, capacity 17 = {{x = -636.748779, y = 478.42099}, {
        x = -685.850098, y = 485.325958}, {x = -693.305481, y = 486.390808}, {x = -697.200562, y = 490.64798}, {x = -703.997437, y = 499.14978}, {x = -747.272766, y = 547.756348}, {x = -777.266418, 
        y = 527.908142}, {x = -782.702332, y = 495.082153}, {x = -816.920166, y = 475.299103}, {x = -815.89032, y = 420.013}, {x = -747.313904, y = 417.672302}, {x = -732.657715, y = 381.498627}, {
        x = -696.759766, y = 366.16629}, {x = -674.261658, y = 385.216248}, {x = -691.661377, y = 464.711182}, {x = -684.448914, y = 469.101318}, {x = -645.275513, y = 464.997101}}}, [26] = {type = "", 
    center = {x = -641.179932, y = 629.015076}, border = std::vector of length 20, capacity 20 = {{x = -546.166016, y = 629.015076}, {x = -542.704041, y = 650.419678}, {x = -537.409729, y = 677.021973}, 
      {x = -544.001892, y = 713.246094}, {x = -590.231018, y = 723.221008}, {x = -610.796082, y = 750.097168}, {x = -666.222168, y = 751.516785}, {x = -709.482361, y = 733.800232}, {x = -704.804871, 
        y = 690.434265}, {x = -765.526855, y = 680.095947}, {x = -749.007263, y = 642.870239}, {x = -758.565979, y = 604.021851}, {x = -723.437195, y = 571.212341}, {x = -695.581787, y = 550.618591}, {
        x = -675.913574, y = 533.116211}, {x = -653.645874, y = 510.978363}, {x = -617.006104, y = 524.287354}, {x = -589.502625, y = 559.768982}, {x = -550.057312, y = 565.261658}, {x = -546.87854, 
        y = 613.394836}}}, [25] = {type = "", center = {x = -294.827942, y = -710.270569}, border = std::vector of length 18, capacity 18 = {{x = -188.58873, y = -710.270569}, {x = -220.738647, 
        y = -675.376282}, {x = -252.490005, y = -676.815002}, {x = -253.813095, y = -631.579651}, {x = -276.832275, y = -595.527283}, {x = -308.564117, y = -599.758118}, {x = -354.337494, 
        y = -613.270325}, {x = -378.104584, y = -642.994019}, {x = -310.392883, y = -703.645569}, {x = -304.835388, y = -710.534668}, {x = -416.363861, y = -779.14917}, {x = -350.843903, 
        y = -792.378357}, {x = -318.079315, y = -810.313354}, {x = -284.580719, y = -828.656128}, {x = -250.458832, y = -813.473022}, {x = -233.849045, y = -776.51239}, {x = -195.459183, 
        y = -767.356445}, {x = -212.059265, y = -723.161926}}}, [14] = {type = "", center = {x = -542.323364, y = 386.144806}, border = std::vector of length 19, capacity 19 = {{x = -396.586151, 
        y = 386.144806}, {x = -441.822754, y = 420.917297}, {x = -467.867889, y = 433.139557}, {x = -470.838196, y = 487.711426}, {x = -501.402893, y = 522.881897}, {x = -533.147949, y = 527.914551}, {
        x = -584.139343, y = 482.031189}, {x = -595.5979, y = 445.430786}, {x = -647.828491, y = 430.669647}, {x = -634.675476, y = 403.01297}, {x = -639.958374, y = 366.56955}, {x = -588.056946, 
        y = 361.467346}, {x = -577.612915, y = 338.517914}, {x = -581.537354, y = 257.866241}, {x = -521.984436, y = 276.375946}, {x = -510.654419, y = 313.593811}, {x = -499.692444, y = 334.858246}, {
        x = -459.095642, y = 330.639893}, {x = -424.274841, y = 354.518463}}}, [13] = {type = "", center = {x = -631.406616, y = 26.0027504}, border = std::vector of length 17, capacity 17 = {{
        x = -536.94873, y = 26.0027504}, {x = -519.886658, y = 50.4573288}, {x = -582.547913, y = 64.7430725}, {x = -595.012024, y = 76.0855484}, {x = -610.009949, y = 144.103531}, {x = -657.354004, 
        y = 106.634109}, {x = -682.004883, y = 88.581871}, {x = -707.553528, y = 62.4170609}, {x = -735.377441, y = 36.7301712}, {x = -706.761292, y = 1.79743576}, {x = -715.603577, y = -62.3409615}, {
        x = -704.502869, y = -120.15567}, {x = -662.158142, y = -113.802032}, {x = -611.926147, y = -96.3725739}, {x = -589.17572, y = -40.2422523}, {x = -545.490295, y = -33.4697342}, {x = -534.813293, 
        y = 10.6883488}}}, [12] = {type = "", center = {x = -788.763855, y = 218.169495}, border = std::vector of length 18, capacity 18 = {{x = -634.127014, y = 218.169495}, {x = -709.500122, 
        y = 256.296844}, {x = -695.322266, y = 312.119904}, {x = -731.380127, y = 311.246552}, {x = -774.589905, y = 341.458954}, {x = -809.553589, y = 359.613953}, {x = -829.959351, y = 290.229736}, {
        x = -908.270691, y = 312.765411}, {x = -880.826355, y = 259.073029}, {x = -867.335876, y = 231.565674}, {x = -906.216003, y = 209.671677}, {x = -898.766785, y = 153.646057}, {x = -861.699463, 
        y = 136.129868}, {x = -835.42041, y = 56.0106049}, {x = -789.257446, y = 144.364136}, {x = -750.206787, y = 123.665489}, {x = -687.189148, y = 130.456482}, {x = -691.457581, y = 178.35788}}}, 
  [11] = {type = "", center = {x = 656.361938, y = -37.8396912}, border = std::vector of length 19, capacity 19 = {{x = 778.632446, y = -37.8396912}, {x = 780.209045, y = -10.1093788}, {x = 771.065552, 
        y = 53.5811386}, {x = 721.700806, y = 45.5825272}, {x = 709.513794, y = 68.928978}, {x = 671.101746, y = 87.9976654}, {x = 617.10199, y = 59.976326}, {x = 631.576355, y = -4.63269424}, {
        x = 619.106018, y = -20.1498375}, {x = 588.188049, y = -22.5836945}, {x = 591.408508, y = -39.7069817}, {x = 595.569824, y = -64.3114471}, {x = 625.256775, y = -72.6207733}, {x = 633.001587, 
        y = -91.1227875}, {x = 649.501648, y = -78.7809906}, {x = 672.662842, y = -103.908821}, {x = 713.344055, y = -150.359238}, {x = 726.417175, y = -89.6595917}, {x = 745.736023, y = -55.2934875}}}, 
  [9] = {type = "", center = {x = 598.623108, y = -226.719925}, border = std::vector of length 19, capacity 19 = {{x = 729.113892, y = -226.719925}, {x = 647.88562, y = -200.437759}, {x = 641.891602, 
        y = -190.135971}, {x = 634.23761, y = -145.264496}, {x = 606.669312, y = -109.98761}, {x = 579.951904, y = -145.018661}, {x = 557.306702, y = -167.929108}, {x = 572.650635, y = -212.901291}, {
        x = 550.277771, y = -222.617416}, {x = 492.896912, y = -243.235458}, {x = 550.49292, y = -253.565887}, {x = 557.10498, y = -281.917053}, {x = 589.080811, y = -249.121094}, {x = 598.261597, 
        y = -254.634232}, {x = 625.731995, y = -345.830811}, {x = 653.52356, y = -344.94986}, {x = 705.599854, y = -306.097473}, {x = 673.832153, y = -260.208527}, {x = 701.58252, y = -240.961792}}}, 
  [10] = {type = "", center = {x = 497.269501, y = -84.4501648}, border = std::vector of length 18, capacity 18 = {{x = 541.15625, y = -84.4501648}, {x = 547.0401, y = -58.7341194}, {x = 572.310242, 
        y = -18.955162}, {x = 555.059448, y = 5.43842316}, {x = 509.338654, y = 24.6400528}, {x = 478.719635, y = 8.76939392}, {x = 426.8255, y = 40.4604797}, {x = 431.469055, y = -10.6568069}, {
        x = 404.966736, y = -44.8812714}, {x = 365.579315, y = -93.538063}, {x = 386.694977, y = -115.582108}, {x = 458.783203, y = -120.96907}, {x = 460.698608, y = -186.12355}, {x = 507.831696, 
        y = -190.266556}, {x = 534.492554, y = -171.822891}, {x = 532.5271, y = -134.766266}, {x = 540.147766, y = -121.778763}, {x = 548.562195, y = -104.939423}}}, [15] = {type = "", center = {
      x = -130.206451, y = 595.706909}, border = std::vector of length 20, capacity 20 = {{x = -14.622673, y = 595.706909}, {x = -29.5571671, y = 620.30719}, {x = -29.9081573, y = 650.173462}, {
        x = -64.4002228, y = 672.470337}, {x = -80.4562378, y = 715.598511}, {x = -118.128311, y = 715.479675}, {x = -186.932144, y = 730.710693}, {x = -203.426331, y = 679.274353}, {x = -237.239868, 
        y = 670.011902}, {x = -247.80983, y = 642.265381}, {x = -258.10083, y = 594.562866}, {x = -180.520264, y = 576.609802}, {x = -158.560486, y = 576.981201}, {x = -197.128922, y = 499.855103}, {
        x = -150.655975, y = 493.085632}, {x = -121.350967, y = 451.701233}, {x = -81.6245117, y = 450.389709}, {x = -55.6952515, y = 478.488708}, {x = -63.4339066, y = 549.649048}, {x = -31.1008987, 
        y = 582.859375}}}, [16] = {type = "", center = {x = -372.9487, y = 689.737427}, border = std::vector of length 16, capacity 16 = {{x = -271.836365, y = 689.737427}, {x = -264.665802, 
        y = 740.080566}, {x = -318.93988, y = 739.518188}, {x = -347.898102, y = 762.961853}, {x = -357.183594, y = 826.217529}, {x = -407.460175, y = 793.888672}, {x = -458.426056, y = 778.592041}, {
        x = -480.539154, y = 747.234985}, {x = -474.512451, y = 710.86499}, {x = -498.104736, y = 665.430237}, {x = -460.534424, y = 618.00177}, {x = -472.259094, y = 563.887695}, {x = -398.271179, 
        y = 567.52301}, {x = -337.032501, y = 567.919067}, {x = -294.295105, y = 605.850647}, {x = -311.848785, y = 651.511902}}}, [17] = {type = "", center = {x = 201.620575, y = -270.102844}, 
    border = std::vector of length 18, capacity 18 = {{x = 337.179382, y = -270.102844}, {x = 325.388763, y = -243.557281}, {x = 240.296692, y = -244.297745}, {x = 231.837509, y = -224.498962}, {
        x = 242.565552, y = -125.157928}, {x = 200.651459, y = -158.266937}, {x = 163.023026, y = -160.298828}, {x = 193.853546, y = -259.332855}, {x = 190.559662, y = -264.44278}, {x = 127.670464, 
        y = -254.714005}, {x = 160.538528, y = -273.148773}, {x = 151.567505, y = -300.824677}, {x = 135.556641, y = -359.012085}, {x = 184.635223, y = -391.462738}, {x = 248.838287, y = -405.952118}, {
        x = 283.23526, y = -359.918671}, {x = 291.907776, y = -330.112396}, {x = 296.624207, y = -305.374969}}}, [18] = {type = "", center = {x = 307.656586, y = 604.677551}, 
    border = std::vector of length 19, capacity 19 = {{x = 393.920105, y = 604.677551}, {x = 413.091064, y = 650.046265}, {x = 383.497528, y = 689.03186}, {x = 339.905121, y = 715.00415}, {
        x = 299.532074, y = 720.348633}, {x = 278.615814, y = 679.232788}, {x = 230.041534, y = 708.334229}, {x = 223.448853, y = 662.012085}, {x = 198.049072, y = 645.425781}, {x = 196.448669, 
        y = 607.499146}, {x = 213.826477, y = 578.823547}, {x = 227.434204, y = 553.4198}, {x = 207.635864, y = 500.019653}, {x = 284.950378, y = 547.321838}, {x = 306.467041, y = 538.728027}, {
        x = 353.890656, y = 474.365662}, {x = 369.510071, y = 507.525421}, {x = 415.69104, y = 542.765625}, {x = 438.946472, y = 589.169312}}}, [19] = {type = "", center = {x = 54.5541229, 
---Type <return> to continue, or q <return> to quit---
      y = 542.99707}, border = std::vector of length 17, capacity 17 = {{x = 147.511993, y = 542.99707}, {x = 167.714539, y = 581.702148}, {x = 154.016144, y = 603.847473}, {x = 125.030968, 
        y = 651.616943}, {x = 70.3009415, y = 668.357727}, {x = 31.2465858, y = 676.414551}, {x = 11.0171127, y = 619.474854}, {x = 33.8761826, y = 564.760315}, {x = 1.85278702, y = 567.267151}, {
        x = 4.73807526, y = 539.774963}, {x = -11.3185196, y = 517.076111}, {x = -33.6810913, y = 445.237061}, {x = 13.0360222, y = 432.151184}, {x = 62.4353485, y = 458.330353}, {x = 132.098267, 
        y = 425.846741}, {x = 127.331802, y = 481.326202}, {x = 176.71373, y = 504.789856}}}, [20] = {type = "", center = {x = 503.743713, y = 727.072449}, 
    border = std::vector of length 19, capacity 19 = {{x = 653.730774, y = 727.072449}, {x = 610.881409, y = 766.531128}, {x = 626.987061, y = 811.444275}, {x = 570.887085, y = 808.59729}, {
        x = 549.709534, y = 843.809814}, {x = 487.570038, y = 865.159241}, {x = 440.585815, y = 835.447205}, {x = 397.757599, y = 823.902527}, {x = 389.524994, y = 790.745789}, {x = 394.778442, 
        y = 734.606873}, {x = 444.450012, y = 707.354919}, {x = 444.189819, y = 671.872192}, {x = 450.557373, y = 619.319763}, {x = 496.342682, y = 649.711792}, {x = 523.815674, y = 669.770508}, {
        x = 580.451172, y = 604.455139}, {x = 580.11084, y = 652.260498}, {x = 639.317627, y = 679.884888}, {x = 621.23468, y = 713.288452}}}, [21] = {type = "", center = {x = -485.87915, 
      y = -79.1668701}, border = std::vector of length 19, capacity 19 = {{x = -334.348938, y = -79.1668701}, {x = -386.043579, y = -55.4336243}, {x = -370.412537, y = -23.2575226}, {x = -398.495117, 
        y = -7.13382721}, {x = -415.124207, y = 37.3668289}, {x = -457.883179, y = 57.7288361}, {x = -492.796326, y = 0.0674972534}, {x = -501.163269, y = -42.9123116}, {x = -497.557861, 
        y = -63.0896072}, {x = -506.989563, y = -64.3710938}, {x = -540.887512, y = -72.168396}, {x = -577.702515, y = -90.8560028}, {x = -560.341919, y = -121.369705}, {x = -540.152283, 
        y = -157.800171}, {x = -507.62149, y = -150.542236}, {x = -471.765717, y = -168.766312}, {x = -425.453857, y = -177.914215}, {x = -372.973541, y = -165.525574}, {x = -369.892944, 
        y = -114.252266}}}, [22] = {type = "", center = {x = -419.602844, y = -300.128296}, border = std::vector of length 19, capacity 19 = {{x = -284.672058, y = -300.128296}, {x = -286.018982, 
        y = -265.225342}, {x = -320.444, y = -242.0896}, {x = -338.650208, y = -197.612732}, {x = -383.925232, y = -206.403656}, {x = -405.995636, y = -215.646896}, {x = -445.752594, y = -220.953796}, {
        x = -477.897095, y = -205.299667}, {x = -507.55011, y = -210.994598}, {x = -485.92218, y = -275.490265}, {x = -525.315002, y = -303.904114}, {x = -532.235229, y = -335.918396}, {x = -508.183167, 
        y = -362.413544}, {x = -496.891907, y = -410.094421}, {x = -440.11554, y = -406.105652}, {x = -404.934967, y = -415.962402}, {x = -363.631195, y = -409.906311}, {x = -363.536987, 
        y = -353.546021}, {x = -319.386719, y = -340.124481}}}, [23] = {type = "", center = {x = -34.3180542, y = -667.940125}, border = std::vector of length 17, capacity 17 = {{x = 146.356995, 
        y = -667.940125}, {x = 84.1822281, y = -632.996704}, {x = 72.4694138, y = -605.936829}, {x = 50.493988, y = -566.387573}, {x = 32.0840302, y = -537.017456}, {x = -30.3596687, y = -584.008728}, {
        x = -50.6639519, y = -609.568542}, {x = -93.3501434, y = -604.020813}, {x = -113.629326, y = -620.892273}, {x = -124.970795, y = -662.725586}, {x = -159.811111, y = -721.398193}, {
        x = -112.21331, y = -727.199158}, {x = -92.8296814, y = -741.296143}, {x = -66.5538177, y = -776.522339}, {x = -19.3176193, y = -779.951111}, {x = 44.074295, y = -776.332947}, {x = 78.2002258, 
        y = -726.944946}}}, [24] = {type = "", center = {x = -116.75943, y = -547.044434}, border = std::vector of length 17, capacity 17 = {{x = -29.8689651, y = -547.044434}, {x = -88.6296539, 
        y = -536.339172}, {x = -89.8099899, y = -528.562683}, {x = -82.6570511, y = -490.036041}, {x = -75.6471863, y = -403.5979}, {x = -136.165253, y = -431.306305}, {x = -161.244553, 
        y = -439.369812}, {x = -206.625885, y = -474.474854}, {x = -260.697296, y = -513.437744}, {x = -249.612823, y = -564.029236}, {x = -224.127914, y = -604.005981}, {x = -193.249069, 
        y = -639.913086}, {x = -140.104736, y = -591.098877}, {x = -117.13739, y = -561.369263}, {x = -113.063866, y = -558.572021}, {x = -103.091606, y = -566.146301}, {x = -70.1027374, 
        y = -572.074524}}}}'

parse.terrain <- function(v) {
    v <- gsub("\\[\\d+?\\] = ", "", v)
    v <- gsub("std::vector of length \\d+?, capacity \\d+? = ", "", v)
    v <- gsub("---Type <return> to continue, or q <return> to quit---", "", v)
    v <- gsub("\\{", "list(", v)
    v <- gsub("\\}", ")", v)
    eval(parse_expr(v))
}

buf <- parse.terrain(terrain.text)
terrain <- do.call(rbind, lapply(seq_along(buf), function(i) {
    data.frame(type = "terrain", tid = i, t(sapply(buf[[i]]$border, unlist)))
}))

data <- list(
    path = '{x = 198.318817, y = -116.441772}, {x = 269.6026, y = -89.16436}, {x = 234.456314, y = -54.0907478}, {x = 152.104538, y = -99.5311737}, {x = 147.667328, 
    y = -81.1170654}, {x = 141.845886, y = -17.8447876}, {x = 112.687599, y = -21.884964}, {x = 71.3330994, y = -29.6252213}, {x = 59.0128326, y = -62.4899483}, {x = 40.787117, y = -79.986496}, {
    x = 27.799942, y = -127.107071}, {x = 56.5546265, y = -167.284546}, {x = 59.1952209, y = -197.254425}, {x = 115.702286, y = -184.018982}, {x = 142.507843, y = -182.27681}, {x = 146.350357, 
    y = -147.207169}, {x = 168.248291, y = -146.321762}, {x = 198.034805, y = -135.944092}',
    p = '{x = 153.530273, y = -98.1001968}',
    center = '{x = 135.25589, y = -116.441772}'
)

load.border <- function(v) {
    do.call(rbind, eval(parse_expr(gsub('\\}', ')', gsub('\\{', 'c(', gsub('#', v, 'list(#)'))))))
}

df <- do.call(rbind, lapply(names(data), function(k) data.frame(load.border(data[k]), type = k, tid = -1)))
df <- rbind(df, terrain)
df$y <- -df$y

angle2 <- function(M,N = c(1,0)){
    atan2(N[2],N[1]) - atan2(M[2],M[1]) 
}

rbuf <- 2.01999998
center = c(x = 135.25589, y = -116.441772)
border = apply(df[df$type=='path',], 1, function(xs) {
    x <- as.numeric(xs[1:2])
    d <- x - center
    a <- angle2(d)
    x + rbuf * c(cos(a), sin(a))
})

df[df$type == 'path', 1:2] <- t(border)

ggplot(df, aes(x = x, y = y, group = interaction(type, tid), color = type)) + geom_path() + geom_point()
